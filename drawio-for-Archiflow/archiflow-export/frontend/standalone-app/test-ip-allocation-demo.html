<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArchiFlow IP Allocation Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .output {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.connected {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .status.disconnected {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        .status.pending {
            background: #feebc8;
            color: #7c2d12;
            border: 1px solid #fbd38d;
        }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }
        .card h3 {
            margin-top: 0;
            color: #667eea;
        }
        .instructions {
            background: #edf2f7;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #333;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 8px 0;
        }
        .code {
            background: #2d3748;
            color: #68d391;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê ArchiFlow IP Allocation Demo</h1>
        
        <div class="instructions">
            <h3>üìã Setup Instructions:</h3>
            <ol>
                <li>Start the MCP server: <span class="code">node build/index.js</span></li>
                <li>Open Draw.io in your browser</li>
                <li>Install the Draw.io MCP browser extension if not already installed</li>
                <li>The extension should connect to the MCP server on port 3333</li>
                <li>Use the controls below to test IP allocation</li>
            </ol>
        </div>

        <div class="status disconnected" id="status">
            ‚ö†Ô∏è MCP Server Status: Not Connected
        </div>

        <h2>üîß IP Pool Management</h2>
        
        <div class="button-group">
            <button onclick="getIPPools()">üìä Get All IP Pools</button>
            <button onclick="getIPUsage()">üìà Get IP Usage Report</button>
            <button onclick="getIPUsageDetailed()">üìù Get Detailed Usage</button>
        </div>

        <h2>‚ûï Allocate IP Address</h2>
        
        <div class="grid">
            <div class="card">
                <h3>Device Information</h3>
                <div class="input-group">
                    <label for="assetId">Asset ID:</label>
                    <input type="text" id="assetId" placeholder="e.g., AST-SW-003" value="AST-SW-003">
                </div>
                <div class="input-group">
                    <label for="description">Description:</label>
                    <input type="text" id="description" placeholder="e.g., Branch Switch 03" value="Branch Switch 03">
                </div>
            </div>
            
            <div class="card">
                <h3>Pool Selection</h3>
                <div class="input-group">
                    <label for="poolId">IP Pool:</label>
                    <select id="poolId">
                        <option value="POOL-001">Management Network (10.0.1.0/24)</option>
                        <option value="POOL-002">Server Network (10.0.20.0/24)</option>
                        <option value="POOL-003">DMZ Network (10.0.30.0/24)</option>
                        <option value="POOL-004">Branch NYC Network (192.168.1.0/24)</option>
                    </select>
                </div>
                <button onclick="allocateIP()" style="width: 100%; margin-top: 10px;">
                    üéØ Allocate IP Address
                </button>
            </div>
        </div>

        <h2>‚ûñ Release IP Address</h2>
        
        <div class="grid">
            <div class="card">
                <div class="input-group">
                    <label for="releaseIp">IP Address to Release:</label>
                    <input type="text" id="releaseIp" placeholder="e.g., 10.0.1.22">
                </div>
                <button onclick="releaseIP()" style="width: 100%; margin-top: 10px;">
                    üîÑ Release IP Address
                </button>
            </div>
        </div>

        <h2>üìÑ Output</h2>
        <div class="output" id="output">Ready to test IP allocation tools...</div>
    </div>

    <script>
        // WebSocket connection to MCP server
        let ws = null;
        let requestId = 1;

        function connectWebSocket() {
            updateStatus('pending', '‚è≥ Connecting to MCP Server...');
            
            ws = new WebSocket('ws://localhost:3333');
            
            ws.onopen = () => {
                updateStatus('connected', '‚úÖ Connected to MCP Server');
                log('WebSocket connected successfully');
            };
            
            ws.onmessage = (event) => {
                const response = JSON.parse(event.data);
                log('Received:', JSON.stringify(response, null, 2));
            };
            
            ws.onerror = (error) => {
                updateStatus('disconnected', '‚ùå Connection Error');
                log('WebSocket error: ' + error);
            };
            
            ws.onclose = () => {
                updateStatus('disconnected', '‚ö†Ô∏è Disconnected from MCP Server');
                log('WebSocket connection closed');
            };
        }

        function updateStatus(type, message) {
            const statusEl = document.getElementById('status');
            statusEl.className = 'status ' + type;
            statusEl.textContent = message;
        }

        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent = `[${timestamp}] ${message}\n` + output.textContent;
        }

        function sendRequest(tool, args) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('‚ùå WebSocket not connected. Please start the MCP server first.');
                return;
            }
            
            const request = {
                jsonrpc: '2.0',
                method: 'tools/call',
                params: {
                    name: tool,
                    arguments: args
                },
                id: requestId++
            };
            
            log(`Sending ${tool} request...`);
            ws.send(JSON.stringify(request));
        }

        function getIPPools() {
            sendRequest('get-ip-pools', {
                includeAllocations: true
            });
        }

        function getIPUsage() {
            sendRequest('get-ip-usage', {});
        }

        function getIPUsageDetailed() {
            sendRequest('get-ip-usage', {
                includeAvailable: true
            });
        }

        function allocateIP() {
            const assetId = document.getElementById('assetId').value;
            const description = document.getElementById('description').value;
            const poolId = document.getElementById('poolId').value;
            
            if (!assetId) {
                log('‚ùå Please enter an Asset ID');
                return;
            }
            
            sendRequest('allocate-ip', {
                poolId: poolId,
                assetId: assetId,
                description: description || `Allocated to ${assetId}`
            });
        }

        function releaseIP() {
            const ip = document.getElementById('releaseIp').value;
            
            if (!ip) {
                log('‚ùå Please enter an IP address to release');
                return;
            }
            
            sendRequest('release-ip', {
                ip: ip
            });
        }

        // Alternative: Direct HTTP calls to test without WebSocket
        async function testDirectly() {
            log('\nüì° Testing with direct tool calls (simulation)...\n');
            
            // This would normally go through the MCP server
            // For demonstration, showing what the calls would look like
            
            const examples = [
                {
                    tool: 'get-ip-pools',
                    args: { includeAllocations: true },
                    description: 'Get all IP pools with current allocations'
                },
                {
                    tool: 'allocate-ip',
                    args: { poolId: 'POOL-001', assetId: 'TEST-001', description: 'Test Device' },
                    description: 'Allocate an IP from Management Network'
                },
                {
                    tool: 'get-ip-usage',
                    args: { poolId: 'POOL-001' },
                    description: 'Get usage report for Management Network'
                },
                {
                    tool: 'release-ip',
                    args: { ip: '10.0.1.22' },
                    description: 'Release IP back to pool'
                }
            ];
            
            examples.forEach(ex => {
                log(`Example: ${ex.tool}`);
                log(`Purpose: ${ex.description}`);
                log(`Arguments: ${JSON.stringify(ex.args, null, 2)}`);
                log('---');
            });
        }

        // Try to connect on page load
        window.onload = () => {
            log('üöÄ ArchiFlow IP Allocation Demo Ready');
            log('Click "Connect to MCP Server" or start testing with the buttons above.');
            
            // Uncomment to auto-connect:
            // connectWebSocket();
        };
    </script>
</body>
</html>